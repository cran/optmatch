
R version 3.2.0 (2015-04-16) -- "Full of Ingredients"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### maxControlsCap
> require('optmatch')
Loading required package: optmatch
Loading required package: survival
The optmatch package has an academic license. Enter relaxinfo() for more information.
> data(nuclearplants)
> mhd2a <- match_on(pr ~ date + cum.n, data = nuclearplants, 
+               within = exactMatch(pr ~ pt, data = nuclearplants))
> mhd2a <- t(mhd2a)
> 
> mhd2a.caliper <- mhd2a + caliper(mhd2a, 3)
> stratumStructure(fullmatch(mhd2a.caliper)) # Works OK: 
5:1 4:1 2:1 1:1 1:2 
  1   2   3   2   1 
Warning message:
In fullmatch(mhd2a.caliper) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> maxControlsCap(mhd2a.caliper)              # no unmatchable Tx
$given.min.controls
0 1 
0 0 

$strictest.feasible.max.controls
  0   1 
0.5 1.0 

> stratumStructure(fullmatch(mhd2a.caliper, max=1))
5:1 4:1 2:1 1:1 
  1   2   2   5 
Warning message:
In fullmatch(mhd2a.caliper, max = 1) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> stratumStructure(fullmatch(mhd2a.caliper, max=1/2))
1:0 0:1 
 22  10 
Warning message:
In fullmatch(mhd2a.caliper, max = 1/2) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> stratumStructure(fullmatch(mhd2a + caliper(mhd2a, 2))) # Problem in version <= .5-9:
5:1 4:1 2:1 1:1 1:2 
  1   2   3   2   1 
Warning message:
In fullmatch(mhd2a + caliper(mhd2a, 2)) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> (mx2 <- maxControlsCap(mhd2a + caliper(mhd2a, 2)))     # caused by unmatchable Tx
$given.min.controls
0 1 
0 0 

$strictest.feasible.max.controls
  0   1 
0.5 1.0 

> stratumStructure(fullmatch(mhd2a + caliper(mhd2a, 2), max=mx2$strictest))
1:0 1:1 0:1 
 19   3   7 
Warning message:
In fullmatch(mhd2a + caliper(mhd2a, 2), max = mx2$strictest) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> stratumStructure(fullmatch(mhd2a + caliper(mhd2a, 2), max=1/2))
1:0 0:1 
 22  10 
Warning message:
In fullmatch(mhd2a + caliper(mhd2a, 2), max = 1/2) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> 
> proc.time()
   user  system elapsed 
  0.973   0.013   0.982 
