
R version 3.2.0 (2015-04-16) -- "Full of Ingredients"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(optmatch)
Loading required package: survival
The optmatch package has an academic license. Enter relaxinfo() for more information.
> data(plantdist)
> 
> plantsfm <- fullmatch(plantdist) 
Warning message:
In fullmatch(plantdist) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> plantsfm1 <- fullmatch(plantdist,min.controls=2, max.controls=3)
Warning message:
In fullmatch(plantdist, min.controls = 2, max.controls = 3) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> 
> stratumStructure(plantsfm)
1:1 1:2 1:3 1:4 1:6 
  2   2   1   1   1 
> stratumStructure(plantsfm1)
1:2 1:3 
  2   5 
> 
> data(nuclearplants)
> psd <- match_on(glm(pr~.-(pr+cost), family=binomial(),
+                        data=nuclearplants),
+              standardization.scale = sd) # sd was standard in < 0.7-2
> stratumStructure(fullmatch(psd))
 5:1  3:1  1:3 1:17 
   1    1    1    1 
Warning message:
In fullmatch(psd) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> stratumStructure(fm.psd.cal <- fullmatch(psd/(psd<.25)))
1:0 3:1 2:1 1:2 1:7 0:1 
  3   1   1   1   1  11 
Warning message:
In fullmatch(psd/(psd < 0.25)) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> 
> psd2 <- match_on(glm(pr~.-(pr+cost), family=binomial(),
+                        data=nuclearplants),
+               standardization.scale = sd,
+               within = exactMatch(pr ~ pt, nuclearplants))
> stratumStructure(fullmatch(psd2,min.controls=1,max.controls=1))
1:1 0:1 
 10  12 
Warning messages:
1: In fullmatch(psd2, min.controls = 1, max.controls = 1) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
2: In fullmatch.BlockedInfinitySparseMatrix(psd2, min.controls = 1,  :
  The problem is infeasible with the given constraints; some units were omitted to allow a match.
> stratumStructure(fullmatch(psd2,min.controls=3,max.controls=3))
1:0 0:1 
 10  22 
Warning message:
In fullmatch(psd2, min.controls = 3, max.controls = 3) :
  Without 'data' argument the order of the match is not guaranteed
    to be the same as your original data.
> 
> 
> ### Tests of min.controls, max.controls
> stratumStructure(fm.psd.cal, min.controls=.5)
 1:0 2+:1  1:2  1:7  0:1 
   3    2    1    1   11 
> stratumStructure(fm.psd.cal, max.controls=3)
 1:0  3:1  2:1  1:2 1:3+  0:1 
   3    1    1    1    1   11 
> stratumStructure(fm.psd.cal, min.controls=.5, max.controls=3)
 1:0 2+:1  1:2 1:3+  0:1 
   3    2    1    1   11 
> 
> ### tests of stratumStructure on non-optmatch objects
> fac <- as.factor(fm.psd.cal)
> tvec <- attr(fm.psd.cal, "contrast.group")
> stratumStructure(fac, tvec)
1:0 3:1 2:1 1:2 1:7 0:1 
  3   1   1   1   1  11 
Warning message:
In stratumStructure.optmatch(fac, tvec) :
  ignoring trtgrp argument to stratumStructure
> stratumStructure(as.integer(fac),tvec)
1:0 3:1 2:1 1:2 1:7 0:1 
  3   1   1   1   1  11 
> 
> proc.time()
   user  system elapsed 
  0.746   0.039   0.777 
